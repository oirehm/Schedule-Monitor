<!DOCTYPE html>
<html>
  <head>
    <head>
      <link rel="icon" href="icon/monitor.png" />
      <link rel="stylesheet" type="text/css" href="css/styles.css" />
    </head>
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />

    <!--Added mobile optimization-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.4/math.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--Added buttons to switch between Schedules-->
  </head>
  <body id="body">
    <div class="button-panel info">
      <button
        id="odd-even-toggle"
        onclick="ToggleScheduleOddEven()"
        class="normal-state schedule-button button"
        style="display: inline">
        Odd/Even Toggle
      </button>
      <button
        id="normal-schedule"
        onclick="NormalSchedule()"
        class="schedule-button button">
        Normal Schedule
      </button>
      <button
        id="late-schedule"
        onclick="LateSchedule()"
        class="schedule-button button">
        Late Start Schedule
      </button>
      <button
        id="minimum-schedule"
        onclick="MinimumSchedule()"
        class="schedule-button button">
        Minimum Day Schedule
      </button>
      <button
        id="auto-schedule"
        onclick="AutoSchedule()"
        class="schedule-button button">
        Auto
      </button>
      <!--Special Schedules
        Anchor Day
        Rally Day
        Minimum Day Extended Snack
        -->
      <select
        id="special-schedule"
        class="schedule-button button"
        onchange="HandleSpecialScheduleChange()">
        <option value="Nothing">Special Schedules</option>
        <option value="anchorSchedule">Anchor Day</option>
        <option value="rallySchedule">Rally Day</option>
        <option value="ExtendedSnackSchedule">Min Extended Snack</option>
      </select>
    </div>

    <title>Schedule Monitor</title>
    <meta charset="utf-8" />
    <meta
      name="description"
      content="Rewordify.com School Clock shows you what period you're in, every second of the day." />

    <div id="container">
      <div id="timer_type" style="font-size: 4em">Loading...</div>
      <div id="subtitle">Please wait</div>
      <div id="currentdt"></div>
      <div id="currentperiodsubtitle"></div>
      <div id="currentschedue"></div>
      <div id="currentlengthofperiod"></div>
      <div id="endofschedulesubtitle"></div>
      <div id="currentduration"></div>
      <div id="nextperiodsubtitle"></div>
      <div id="nextschedule"></div>
      <div
        id="nextduration"
        style="font-size: 5em; margin-top: 8px; color: orange"></div>
      <div id="schedule">
        <div
          style="
            margin-top: 30px;
            display: block;
            width: 100%;
            text-align: center;
          ">
          <div
            style="
              display: inline-block;
              margin-left: auto;
              margin-right: auto;
              text-align: left;
              width: auto;
            "></div>
        </div>
      </div>

      <script>
        // Schedule is shown on screen
        var starts = [];
        var names = [];
        var times = [];
      </script>
      <br />
      <div id="tomorrowScheduleTitle">Tomorrow's Schedule:</div>
      <div id="tomorrowScheduleDisplay">Unknown</div>
      <br />
      <button id="toggleButton" class="button editButton info">Edit</button>
      <div id="modifyContainier" class="hidden draggable">
        Color Scheme:
        <select style="margin-top: 12px" id="colorscheme" onchange="ck()">
          <option value="gb" selected="">Gray on black</option>
          <option value="wb">White on black</option>
          <option value="bw">Black on white</option>
          <option value="dk">Dark room</option>
          <option value="bg">Blue on green</option>
          <option value="py">Purple on yellow</option>
          <option value="sr">Random by minute</option></select
        ><br />
        <!--
        Added QOL to change time adjustment upon new input using oninput and scroll wheel
        -->
        Time adjustment in seconds:
        <input
          type="text"
          style="margin-top: 12px; width: 30px"
          id="timeadj"
          value="0"
          onfocus="if(this.value=='0'){this.value='';}"
          oninput="if(this.value==''){inputTimeAdj('');} else { timeadj(); };adjustInputWidth(this.value);"
          onblur="if(this.value==''){this.value='0'; timeadj();}" />
        <div id="resultDisplay"></div>
        <div id="secondsDisplay"></div>
        <br />
        <div id="fastForward">
          <button onclick="previousDay()" id="previousDay" class="button">
            <<
          </button>
          Day selector
          <button onclick="nextDay()" id="nextDay" class="button">>></button>
        </div>
        <br />
        <div id="frequencySelection">
          Updates per ms:
          <select name="updateTime" id="numbers" class="centered-dropdown">
            <option value="2000">2000</option>
            <option value="1000" selected="">1000</option>
            <option value="250">250</option>
            <option value="200">200</option>
            <option value="100" selected="">100</option>
            <option value="50">50</option>
            <option value="0">Real Time</option>
          </select>
          <br /><br />
          <button id="closeEdit" class="button">Close</button>
        </div>
      </div>
      <br />
      <div class="info">
        <button id="changelogButton" class="bottom">
          <a
            href="https://github.com/oirehm/schedulemonitor/blob/main/Changelog.md"
            target="_blank"
            >Changelog</a
          >
        </button>
        <button id="githubButton" class="bottom">
          <a href="https://github.com/oirehm/schedulemonitor" target="_blank"
            >Github</a
          >
        </button>
        <button id="calendarButton" class="bottom">
          <a
            href="https://www.busd.k12.ca.us/cms/lib/CA02204429/Centricity/Domain/2350/BHS%20Calendar%20and%20Bell%20Schedule%202023-2024%20Updated.pdf"
            target="_blank"
            >School Schedules</a
          >
        </button>
        <button id="showTimerButton" class="bottom" onclick="showTimer()">
          Timer
        </button>
      </div>
      <div id="timerPanel" class="hidden timerPanel draggable resizable">
        <div id="timerDisplay">
          <span id="hourTimer" contenteditable="true">00</span>:<span
            id="minuteTimer"
            contenteditable="true"
            >00</span
          >:<span id="secondTimer" contenteditable="true">00</span>
        </div>
        <br />
        <div id="hintTimer" class="hidden">Click anywhere to stop alarm</div>
        <button
          id="startButton"
          class="timerButton button"
          onclick="startTimer()">
          Start
        </button>
        <button
          id="pauseButton"
          class="hidden timerButton button"
          onclick="pauseTimer()">
          Pause
        </button>
        <button
          id="stopAlarmButton button"
          class="hidden timerButton"
          onclick="stopTimerAlarm()">
          Stop
        </button>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

      <script type="text/javascript">
        // Store default display values of elements
        var defaultDisplays = {};
        var infoElements = document.querySelectorAll(".info");
        infoElements.forEach(function (infoElement) {
          defaultDisplays[infoElement] = getComputedStyle(infoElement).display;
        });

        document.addEventListener("contextmenu", function (event) {
          event.preventDefault();
          infoElements.forEach(function (infoElement) {
            infoElement.style.display =
              infoElement.style.display === "none"
                ? defaultDisplays[infoElement]
                : "none";
          });
        });

        /*
        interact(".resizable").resizable({
          edges: { left: true, right: true, bottom: true, top: true },
          listeners: {
            move: function (event) {
              var target = event.target;
              var x = parseFloat(target.getAttribute("data-x")) || 0;
              var y = parseFloat(target.getAttribute("data-y")) || 0;

              target.style.width = event.rect.width + "px";
              target.style.height = event.rect.height + "px";

              x += event.deltaRect.left;
              y += event.deltaRect.top;

              target.style.transform = "translate(" + x + "px," + y + "px)";

              target.setAttribute("data-x", x);
              target.setAttribute("data-y", y);
            },
          },
          modifiers: [
            interact.modifiers.restrictEdges({
              outer: "parent",
            }),
          ],
          inertia: true,
        });
        */
        interact(".draggable").draggable({
          inertia: true,
          modifiers: [
            interact.modifiers.restrictRect({
              restriction: "parent",
              endOnly: true,
            }),
          ],
          autoScroll: true,

          listeners: {
            move: function (event) {
              var target = event.target;

              var x =
                (parseFloat(target.getAttribute("data-x")) || 0) + event.dx;
              var y =
                (parseFloat(target.getAttribute("data-y")) || 0) + event.dy;

              target.style.transform = "translate(" + x + "px, " + y + "px)";

              target.setAttribute("data-x", x);
              target.setAttribute("data-y", y);
            },
          },
        });

        let timerInterval;
        let isPaused = true;
        let remainingTime = 0;
        let isFinished = false;
        let alarmStopped = false;

        function startTimer() {
          if (isPaused) {
            let hours = parseInt(Grab("hourTimer").textContent);
            let minutes = parseInt(Grab("minuteTimer").textContent);
            let seconds = parseInt(Grab("secondTimer").textContent);

            remainingTime = hours * 3600 + minutes * 60 + seconds;

            if (remainingTime <= 0) {
              Grab("timerDisplay").classList.add("shake");
              setTimeout(() => {
                Grab("timerDisplay").classList.remove("shake");
              }, 400);
              return;
            }

            updateTimerDisplay();
            timerInterval = setInterval(updateTimer, 1000);
            isPaused = false;
            toggleTimerButton();
          }
          Grab("hourTimer").removeAttribute("contenteditable");
          Grab("minuteTimer").removeAttribute("contenteditable");
          Grab("secondTimer").removeAttribute("contenteditable");
        }

        function pauseTimer() {
          if (!isPaused) {
            isPaused = true;
            clearInterval(timerInterval);
            toggleTimerButton();
          }
          Grab("hourTimer").setAttribute("contenteditable", "true");
          Grab("minuteTimer").setAttribute("contenteditable", "true");
          Grab("secondTimer").setAttribute("contenteditable", "true");
        }
        function toggleTimerButton() {
          Grab("startButton").classList.toggle("hidden");
          Grab("pauseButton").classList.toggle("hidden");
        }

        function updateTimer() {
          if (isPaused) return;

          remainingTime--;

          if (remainingTime < 0) {
            clearInterval(timerInterval);
            finishTimer();
            return;
          }

          updateTimerDisplay();
        }

        function finishTimer() {
          isFinished = true;
          alarmStopped = false;
          pauseTimer();
          finishInterval = setInterval(flash, 250);
          Grab("startButton").classList.toggle("hidden");
          Grab("stopAlarmButton").classList.toggle("hidden");
          Grab("hintTimer").classList.toggle("hidden");
        }

        function flash() {
          Grab("timerDisplay").classList.toggle("timerFinishedColor");
          Grab("timerPanel").classList.toggle("timerFinishedBorder");
          Grab("body").classList.toggle("timerFinishedBody");
          Grab("timerPanel").classList.toggle("timerPanel");
          const audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();

          const gainNode = audioContext.createGain();
          gainNode.gain.value = 0.2;

          const oscillator = audioContext.createOscillator();
          oscillator.type = "sine";
          oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
          oscillator.connect(gainNode).connect(audioContext.destination);
          oscillator.start();
          oscillator.stop(audioContext.currentTime + 0.1);
        }

        function stopTimerAlarm() {
          alarmStopped = true;
          isFinished = false;
          clearInterval(finishInterval);

          const timerDisplay = Grab("timerDisplay");
          const timerPanel = Grab("timerPanel");
          const body = Grab("body");
          if (timerDisplay.classList.contains("timerFinishedColor")) {
            timerDisplay.classList.remove("timerFinishedColor");
            timerPanel.classList.remove("timerFinishedBorder");
            body.classList.remove("timerFinishedBody");
            timerPanel.classList.add("timerPanel");
          }

          Grab("startButton").classList.toggle("hidden");
        }
        function updateTimerDisplay() {
          let hours = Math.floor(remainingTime / 3600);
          let minutes = Math.floor((remainingTime % 3600) / 60);
          let seconds = remainingTime % 60;

          document.getElementById("hourTimer").textContent = hours
            .toString()
            .padStart(2, "0");
          document.getElementById("minuteTimer").textContent = minutes
            .toString()
            .padStart(2, "0");
          document.getElementById("secondTimer").textContent = seconds
            .toString()
            .padStart(2, "0");
        }

        const timers = document.querySelectorAll("[contenteditable=true]");

        // Limits each input to two digits
        timers.forEach((timer) => {
          timer.addEventListener("input", function () {
            let value = this.textContent.trim();

            if (!isNaN(value)) {
              value = value.slice(0, 2);
              this.textContent = value.padStart(2, "0");
            } else {
              this.textContent = "00";
            }
          });
        });
        // Stops the alarm if a click is detected on the screen
        document.addEventListener("click", function () {
          if (isFinished) {
            stopTimerAlarm();
          }
        });
      </script>
      <br /><br />

      <script type="text/javascript">
        // DO NOT DELETE
        function Grab(getElementById) {
          return document.getElementById(getElementById);
        }
        function GrabQuery(querySelector) {
          return document.querySelector(querySelector);
        }

        Grab("toggleButton").addEventListener("click", function () {
          let panel = Grab("modifyContainier");
          panel.classList.toggle("hidden");

          let button = Grab("toggleButton");
          button.classList.toggle("selected-bottom");
        });

        Grab("closeEdit").addEventListener("click", function () {
          let panel = Grab("modifyContainier");
          panel.classList.toggle("hidden");
          let button = Grab("toggleButton");
          button.classList.remove("selected-bottom");
        });
        // Show timer
        Grab("showTimerButton").addEventListener("click", function () {
          let panel = Grab("timerPanel");
          panel.classList.toggle("hidden");
          let button = Grab("showTimerButton");
          button.classList.toggle("selected-bottom");
        });

        function updateAndCallAgain() {
          var selectedValue = Grab("numbers").value;
          showclock();
          setTimeout(updateAndCallAgain, selectedValue);
          checkTimerType();
          checkDayChange();
        }

        function checkDayChange() {
          let today = new Date().getDate();
          var og = new Date();
          var currentDay = new Date(og.getTime() + adjustseconds * 1000);
          if (currentDay.getDate() !== today) {
            today = currentDay.getDate();
            AutoSchedule();
          }
        }

        window.onload = function () {
          NormalSchedule();
          updateAndCallAgain();
          AutoSchedule();
        };

        Grab("numbers").addEventListener("change", function () {
          var selectedValue = this.value;
          updateAndCallAgain();
        });
        function checkTimerType() {
          var timerType = Grab("timer_type").textContent;

          // Check if the content of the div is "Loading..."
          if (timerType === "Loading...") {
            // If it is, call NormalSchedule after 20ms
            NormalSchedule();
          }
        }

        let timeAdjInput = GrabQuery("#timeadj");

        timeAdjInput.addEventListener("wheel", function (event) {
          event.preventDefault(); // prevent default behavior
          let currentVal = parseFloat(this.value);
          if (isNaN(currentVal)) {
            currentVal = 0;
          }
          let newVal;
          if (event.deltaY > 0) {
            newVal = currentVal - 1; // scroll up, decrease value
          } else {
            newVal = currentVal + 1; // scroll down, increase value
          }
          this.value = newVal;
          timeadj();
        });

        let fastForwardLeft = GrabQuery("#fastForward");

        fastForwardLeft.addEventListener("wheel", function (event) {
          event.preventDefault(); // prevent default behavior
          let currentVal = parseFloat(this.value);
          if (isNaN(currentVal)) {
            currentVal = 0;
          }
          let newVal;
          if (event.deltaY > 0) {
            previousDay();
          } else {
            nextDay();
          }
          this.value = newVal;
        });

        // date and time variables
        var days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        var months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];
        var randm = false;
        var adjustseconds = 0;
        function previousDay() {
          adjustseconds -= 86400;
          var inputBox = Grab("timeadj");
          inputBox.value = adjustseconds;
          AutoSchedule();
          timeadj();
        }
        function nextDay() {
          adjustseconds += 86400;
          var inputBox = Grab("timeadj");
          inputBox.value = adjustseconds;
          AutoSchedule();
          timeadj();
        }
        function ErrorTimeAdj() {
          Grab("timeadj").style.backgroundColor = "SandyBrown";
          adjustseconds = 0;
          secondsDisplay.textContent = "";
          resultDisplay.textContent = "";
        }

        function ValidTimeAdj() {
          Grab("timeadj").style.backgroundColor = "White";
        }

        function timeadj() {
          let oldAdjustSeconds = adjustseconds;
          adjustseconds = Grab("timeadj").value;

          // Check if the new value is a real number
          if (isNaN(adjustseconds)) {
            // If it'displaySeconds not a real number, revert to the old value
            adjustseconds = oldAdjustSeconds;
            ErrorTimeAdj();
          } else {
            ValidTimeAdj();
          }

          evaluateMath();
          showclock();
        }

        function inputTimeAdj(input) {
          let oldAdjustSeconds = adjustseconds;
          adjustseconds = parseFloat(input);

          if (isNaN(adjustseconds)) {
            if (!isNaN(oldAdjustSeconds)) {
              adjustseconds = oldAdjustSeconds;
            } else {
              adjustseconds = 0;
            }
            ErrorTimeAdj();
          } else {
            ValidTimeAdj();
          }

          evaluateMath();
          showclock();
        }

        //  Special math?????????????????????????????????????????????????????????
        function evaluateMath() {
          let input = Grab("timeadj").value;
          var oldAdjustSeconds = adjustseconds;
          let result = math.evaluate(input);

          if (!isNaN(math.evaluate(input))) {
            try {
              if (!isNaN(result) && !/^[0-9]+$/.test(input)) {
                formatMath(true, result);
              } else if (/^[0-9]+$/.test(input)) {
                adjustseconds = input;
                if (Math.abs(input) > 60) {
                  formatMath(true, input);
                  secondsDisplay.textContent = "";
                }
                if (Math.abs(input) < 60) {
                  secondsDisplay.textContent = "";
                  resultDisplay.textContent = "";
                }
              }
              adjustseconds = result;
              ValidTimeAdj();
            } catch (error) {
              adjustseconds = oldAdjustSeconds;
              ErrorTimeAdj();
              formatMath(false);
            }
          } else {
            formatMath(false);
          }
          if (!isFinite(result)) {
            adjustseconds = 0;
            secondsDisplay.textContent =
              "and the universe is now dead because of you";
            resultDisplay.textContent = "Infinity";
          }
        }

        function formatMath(isMathExpression, result) {
          var resultDisplay = Grab("resultDisplay");
          var secondsDisplay = Grab("secondsDisplay");

          if (isMathExpression) {
            var formattedResult = formatTime(result);
            if (formattedResult == 0) {
              resultDisplay.textContent = "= 0s";
            } else {
              resultDisplay.textContent = "= " + formattedResult;
            }
            secondsDisplay.textContent = "= " + result + " seconds";
          } else {
            resultDisplay.textContent = "";
            secondsDisplay.textContent = "";
          }
        }

        function adjustInputWidth(value) {
          var inputElement = Grab("timeadj");
          var inputWidth = getTextWidth(value);
          inputElement.style.width = inputWidth + "px";
        }

        // Helper function to calculate the width of the text
        function getTextWidth(text) {
          var canvas = document.createElement("canvas");
          var context = canvas.getContext("2d");
          context.font = getComputedStyle(document.body).fontSize + " Arial"; // Set font and size
          var width = context.measureText(text).width;
          if (width < 30) {
            width = 30;
          }
          return width;
        }

        function formatTime(seconds) {
          var isNegative = seconds < 0;

          seconds = Math.abs(seconds);
          var centuries = Math.floor(seconds / (3600 * 24 * 365 * 100));
          var years = Math.floor(
            (seconds % (3600 * 24 * 365 * 100)) / (3600 * 24 * 365)
          );
          var days = Math.floor((seconds % (3600 * 24 * 365)) / (3600 * 24));
          var hours = Math.floor((seconds % (3600 * 24)) / 3600);
          var minutes = Math.floor((seconds % 3600) / 60);
          var remainingSeconds = Math.floor(seconds % 60);

          var formattedTime = "";
          if (isNegative) {
            formattedTime += "-";
          }

          if (centuries != 0) {
            formattedTime += centuries + "c ";
          }

          if (years != 0) {
            formattedTime += years + "y ";
          }

          if (days != 0) {
            formattedTime += days + "d ";
          }

          if (hours != 0) {
            formattedTime += hours + "h ";
          }

          if (minutes != 0) {
            formattedTime += minutes + "m ";
          }

          if (remainingSeconds != 0 || formattedTime === "-") {
            formattedTime += remainingSeconds + "s ";
          }

          return formattedTime.trim();
        }

        function colorizerandom() {
          var r1 = Math.floor(Math.random() * 254 + 1);
          var g1 = Math.floor(Math.random() * 254 + 1);
          var b1 = Math.floor(Math.random() * 254 + 1);
          var r2 = Math.floor(Math.random() * 254 + 1);
          var g2 = Math.floor(Math.random() * 254 + 1);
          var b2 = Math.floor(Math.random() * 254 + 1);
          document.body.style.color = "rgb(" + r1 + "," + g1 + "," + b1 + ")";
          document.body.style.backgroundColor =
            "rgb(" + r2 + "," + g2 + "," + b2 + ")";
        }

        // Handles switching background and text color based on dropdown menu input
        function ck() {
          opt = Grab("colorscheme");
          if (opt.value == "gb") {
            randm = false;
            opt.style.color = "black";
            opt.style.backgroundColor = "white";
            document.body.style.color = "grey";
            document.body.style.backgroundColor = "black";
          }
          if (opt.value == "wb") {
            randm = false;
            opt.style.color = "black";
            opt.style.backgroundColor = "white";
            document.body.style.color = "white";
            document.body.style.backgroundColor = "black";
          }
          if (opt.value == "bw") {
            randm = false;
            opt.style.color = "black";
            opt.style.backgroundColor = "white";
            document.body.style.color = "black";
            document.body.style.backgroundColor = "white";
          }
          if (opt.value == "dk") {
            randm = false;
            opt.style.color = "crimson";
            opt.style.backgroundColor = "black";
            document.body.style.color = "crimson";
            document.body.style.backgroundColor = "black";
          }
          if (opt.value == "bg") {
            randm = false;
            opt.style.color = "#5077BE";
            opt.style.backgroundColor = "#D9FFB2";
            document.body.style.color = "#5077BE";
            document.body.style.backgroundColor = "#D9FFB2";
          }
          if (opt.value == "py") {
            randm = false;
            opt.style.color = "#B44DE0";
            opt.style.backgroundColor = "#FFFF99";
            document.body.style.color = "#B44DE0";
            document.body.style.backgroundColor = "#FFFF99";
          }
          if (opt.value == "sr") {
            randm = true;
            colorizerandom();
          }
        }

        // setTimeout(showclock, 1000);
        let randomChange = false;
        // Handles code for the actual clock functionality
        function showclock() {
          var currentPeriod = -1;
          var originalDate = new Date();
          var adjustedDate = new Date(
            originalDate.getTime() + adjustseconds * 1000
          );

          var formattedDate = adjustedDate.getDate();
          if (formattedDate < 10) {
            formattedDate = "0" + formattedDate;
          }
          var formattedHours = adjustedDate.getHours();
          var meridiem = formattedHours >= 12 ? "PM" : "AM";
          formattedHours = formattedHours % 12;
          if (formattedHours == 0) {
            formattedHours = 12;
          }
          if (formattedHours < 10) {
            formattedHours = "0" + formattedHours;
          }
          var fomattedMinutes = adjustedDate.getMinutes();
          if (fomattedMinutes < 10) {
            fomattedMinutes = "0" + fomattedMinutes;
          }
          var formattedSeconds = adjustedDate.getSeconds();
          if (randm && formattedSeconds == 0 && !randomChange) {
            colorizerandom();
            randomChange = true;
          } else if (!(formattedSeconds == 0)) {
            randomChange = false;
          }
          if (formattedSeconds < 10) {
            formattedSeconds = "0" + formattedSeconds;
          }
          var displayedDate =
            days[adjustedDate.getDay()] +
            " " +
            months[adjustedDate.getMonth()] +
            " " +
            formattedDate +
            " " +
            adjustedDate.getFullYear() +
            " " +
            formattedHours +
            ":" +
            fomattedMinutes +
            ":" +
            formattedSeconds +
            " " +
            meridiem;
          Grab("currentdt").innerHTML = displayedDate;
          currentSeconds =
            adjustedDate.getHours() * 3600 +
            adjustedDate.getMinutes() * 60 +
            adjustedDate.getSeconds();
          if (typeof starts !== "undefined") {
            periodIndex = starts.length - 1;
            if (currentSeconds < starts[0]) {
              // Before the Schedule
              Grab("currentperiodsubtitle").innerHTML = "Countdown to";
              Grab("currentschedue").innerHTML = names[0];
              Grab("endofschedulesubtitle").innerHTML = "";
              Grab("currentduration").innerHTML = secondstohhmmss(
                Math.abs(currentSeconds - starts[0])
              );
              Grab("nextperiodsubtitle").innerHTML = "";
              Grab("nextschedule").innerHTML = "";
              Grab("nextduration").innerHTML = "";
            } else if (currentSeconds > starts[periodIndex]) {
              // End of Schedule
              Grab("currentperiodsubtitle").innerHTML = "";
              Grab("currentschedue").innerHTML = names[periodIndex];
              Grab("currentlengthofperiod").innerHTML = "";
              Grab("endofschedulesubtitle").innerHTML =
                "Time elapsed since end of schedule";
              Grab("currentduration").innerHTML = secondstohhmmss(
                currentSeconds - starts[periodIndex]
              );
              Grab("nextperiodsubtitle").innerHTML = "";
              Grab("nextschedule").innerHTML = "";
              Grab("nextduration").innerHTML = "";
            } else {
              for (x = 0; x < periodIndex; x++) {
                if (
                  starts[x] < currentSeconds &&
                  starts[x + 1] > currentSeconds
                ) {
                  // In session
                  currentPeriod = x;
                  Grab("currentperiodsubtitle").innerHTML =
                    "We are now " +
                    secondstohhmmss(currentSeconds - starts[x]) +
                    " into:";
                  Grab("currentschedue").innerHTML = names[x];
                  Grab("endofschedulesubtitle").innerHTML = "";
                  Grab("currentduration").innerHTML = "";
                  // Grab("currentduration").innerHTML=(secondstohhmmss(currentSeconds-starts[x]));
                  // Grab("nextperiodsubtitle").innerHTML="nextduration to:";
                  Grab("nextschedule").innerHTML =
                    "(" + names[x + 1] + ") starts in:";
                  Grab("nextduration").innerHTML = secondstohhmmss(
                    Math.abs(currentSeconds - starts[x + 1])
                  );
                }
              }
            }

            // Format displayed schedule
            if (times.length > 0) {
              var scheduleDisplay =
                "<div style='margin-top:30px;display:block;width:100%;text-align:center'><div style='display:inline-block;margin-left:auto;margin-right:auto;text-align:left;width:auto'>Today's Schedule:<br />";
            } else {
              var scheduleDisplay = "No school today!";
            }
            //scheduleDisplay=scheduleDisplay+times[0]+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+names[0]+'<br />';
            for (x = 0; x < periodIndex; x++) {
              // Highlight current period in schedule
              if (x == currentPeriod) {
                scheduleDisplay = scheduleDisplay + "<strong>";
              }
              disptime = times[x];
              disptimex = times[x + 1];
              disptimez = times[periodIndex];

              // Add meridiem to time
              if (disptime.substring(0, 2) < 12) {
                disptime = disptime + " AM";
              } else {
                hc = disptime.substring(0, 2);
                if (hc > 12) {
                  hc = hc - 12;
                }
                if (hc < 10) {
                  hc = "0" + hc;
                }
                disptime = hc + disptime.substring(2, 5) + " PM";
              }
              if (disptimex.substring(0, 2) < 12) {
                disptimex = disptimex + " AM";
              } else {
                hc = disptimex.substring(0, 2);
                if (hc > 12) {
                  hc = hc - 12;
                }
                if (hc < 10) {
                  hc = "0" + hc;
                }
                disptimex = hc + disptimex.substring(2, 5) + " PM";
              }
              if (disptimez.substring(0, 2) < 12) {
                disptimez = disptimex + " AM";
              } else {
                hc = disptimez.substring(0, 2);
                if (hc > 12) {
                  hc = hc - 12;
                }
                if (hc < 10) {
                  hc = "0" + hc;
                }
                disptimez = hc + disptimez.substring(2, 5) + " PM";
              }
              // Append schedule together on a line
              scheduleDisplay =
                scheduleDisplay +
                disptime +
                "-" +
                disptimex +
                " " +
                names[x] +
                "<br >";
              if (x == currentPeriod) {
                scheduleDisplay = scheduleDisplay + "</strong>";
                Grab("currentlengthofperiod").innerHTML =
                  disptime + "-" + disptimex;
              }
            }

            // End part

            Grab("schedule").innerHTML = scheduleDisplay;
          }
          delete window.d;
        }

        // The actual displayed timer
        function secondstohhmmss(secs) {
          var hour = parseInt(secs / 3600);
          if (hour < 10) {
            hour = "0" + hour;
          }
          if (hour == 0) {
            hour = "00";
          }

          var secs = secs - hour * 3600;
          var minute = parseInt(secs / 60);
          if (minute < 10) {
            minute = "0" + minute;
          }
          if (minute == 0) {
            minute = "00";
          }
          var secs = parseInt(secs - minute * 60);

          var displaySeconds = secs;
          if (displaySeconds < 10) {
            displaySeconds = "0" + displaySeconds;
          }
          if (displaySeconds == 1) {
            Grab("currentduration").innerHTML = "\0";
          }
          if (hour != "00") {
            return hour + ":" + minute + ":" + displaySeconds;
          } else if (minute != "00") {
            return minute + ":" + displaySeconds;
          } else {
            return displaySeconds;
          }
        }

        // Most modifications
        let isEven = false;
        var schedule = -1; // used to store values for even/odd function
        /*
            0 = normal
            1 = late
            2 = minimum / finals
            3 = rally day
            4 = anchor day
            5 = extended snack schedule
            */

        function AutoSchedule() {
          const currentDate = getAdjustedDate();
          const currentDay = currentDate.getDate();
          const currentMonth = currentDate.getMonth() + 1;
          const currentYear = currentDate.getFullYear();
          const currentWeekDay = currentDate.getDay();
          if (currentYear == 2024 && currentMonth <= 6) {
            let scheduleType = getScheduleType(
              currentMonth,
              currentDay,
              currentWeekDay,
              currentYear
            );
            handleScheduleType(scheduleType);
            let result = "";
            let isEvenSchedule = isEvenScheduleDay(currentMonth, currentDay);
            if (isEvenSchedule !== isEven) {
              ToggleScheduleOddEven();
            }

            const tomorrowDate = getTomorrow();
            const tomorrowDay = tomorrowDate.getDate();
            const tomorrowMonth = tomorrowDate.getMonth() + 1;
            const tomorrowYear = tomorrowDate.getFullYear();
            const tomorrowWeekDay = tomorrowDate.getDay();

            scheduleType = getScheduleType(
              tomorrowMonth,
              tomorrowDay,
              tomorrowWeekDay,
              tomorrowYear
            );

            isEvenSchedule = isEvenScheduleDay(tomorrowMonth, tomorrowDay);

            if (scheduleType != "No School") {
              if (isEvenSchedule) {
                result += "Even ";
              } else {
                result += "Odd ";
              }
              result += scheduleType + " Schedule";
            } else {
              result += scheduleType;
            }
            Grab("tomorrowScheduleTitle").classList.remove("hidden");
            Grab("tomorrowScheduleDisplay").classList.remove("hidden");
            Grab("tomorrowScheduleDisplay").innerHTML = result;
            var button = GrabQuery("#auto-schedule");
            button.classList.add("selected-state");
          } else {
            Grab("tomorrowScheduleTitle").classList.add("hidden");
            Grab("tomorrowScheduleDisplay").classList.add("hidden");
          }
        }
        function removeElementById(id) {
          var element = document.getElementById(id);
          if (element) {
            element.parentNode.removeChild(element);
          }
        }

        function clearElementContentById(id) {
          var element = document.getElementById(id);
          if (element) {
            element.innerHTML = "";
          }
        }

        function getAdjustedDate() {
          const og = new Date();
          return new Date(og.getTime() + adjustseconds * 1000);
        }
        function getTomorrow() {
          const og = new Date();
          return new Date(og.getTime() + (adjustseconds + 86400) * 1000);
        }
        const scheduleList = {
          1: {
            late: [22, 29],
            navnight: [23],
            noSchool: [1, 2, 3, 4, 5, 8, 15],
          },
          2: { late: [5, 12, 26], noSchool: [16, 19], rally: [29] },
          3: { late: [4, 11, 18, 25], noSchool: [8, 15, 29] },
          4: { late: [8, 15, 22, 29], noSchool: [1, 2, 3, 4, 5] },
          5: { late: [6, 13, 20], noSchool: [3, 24, 27] },
          6: { final: [3, 4], extended: [5] },
        };

        function getScheduleType(
          currentMonth,
          currentDay,
          currentWeekDay,
          currentYear
        ) {
          const schedule = scheduleList;
          const dayOfWeek = new Date().getDay();
          if (
            (currentWeekDay === 0 || currentWeekDay === 6) &&
            !isNaN(currentYear) &&
            !isNaN(currentWeekDay)
          ) {
            return "No School";
          }
          if (currentYear == 2024 && currentMonth <= 6) {
            if (schedule[currentMonth]?.late?.includes(currentDay)) {
              return "Late";
            }
            if (schedule[currentMonth]?.rally?.includes(currentDay)) {
              return "Rally";
            }
            if (schedule[currentMonth]?.final?.includes(currentDay)) {
              return "Finals";
            }
            if (schedule[currentMonth]?.extended?.includes(currentDay)) {
              return "Extended Snack";
            }
            if (schedule[currentMonth]?.navnight?.includes(currentDay)) {
              return "Navigation Night";
            }
            if (schedule[currentMonth]?.anchor?.includes(currentDay)) {
              return "Anchor";
            }
            if (schedule[currentMonth]?.noSchool?.includes(currentDay)) {
              return "No School";
            }
          }
          return "Normal";
        }
        function handleScheduleType(scheduleType) {
          switch (scheduleType) {
            case "Late":
              LateSchedule();
              break;
            case "Finals":
              MinimumSchedule();
              break;
            case "Extended Snack":
              ExtendedSnackSchedule();
              UpdateSpecialDropDown();
              break;
            case "Navigation Night":
              NavigationNight();
              break;
            case "No School":
              noSchool();
              break;
            case "Rally":
              RallySchedule();
              UpdateSpecialDropDown();
              break;
            case "Anchor":
              AnchorSchedule();
              UpdateSpecialDropDown();
              break;
            default:
              NormalSchedule();
          }
        }

        function isEvenScheduleDay(currentMonth, currentDay) {
          const evenScheduleDates = {
            1: [22, 24, 26, 30],
            2: [1, 5, 7, 9, 13, 15, 21, 23, 27, 29],
            3: [4, 6, 11, 13, 18, 20, 22, 26, 28],
            4: [9, 11, 15, 17, 19, 23, 25, 29],
            5: [1, 6, 8, 10, 14, 16, 20, 22, 28, 30],
            6: [4],
          };

          return evenScheduleDates[currentMonth]?.includes(currentDay);
        }

        function UpdateSpecialDropDown() {
          // Get the dropdown menu
          var dropdownMenu = Grab("special-schedule");
          let internal = schedule;
          switch (internal) {
            case 3:
              dropdownMenu.selectedIndex = 2;
              break;
            case 4:
              dropdownMenu.selectedIndex = 1;
              break;
            case 5:
              dropdownMenu.selectedIndex = 3;
              break;
            default:
              dropdownMenu.selectedIndex = 0;
          }
          HandleSpecialScheduleChange();
        }

        function handleButtonClick() {
          var dropdownMenu = Grab("special-schedule");
          var oddEvenButton = Grab("odd-even-toggle");
          var dropdown = Grab("special-schedule");

          dropdownMenu.style.backgroundColor = ""; // Reset to default color
          dropdownMenu.selectedIndex = 0;
          oddEvenButton.style.display = "inline";
          dropdown.classList.remove("special-schedule-select");

          ClearSubtitle();
          updateClock();
        }

        function updateClock() {
          setTimeout(showclock, 20);
        }

        function NavigationNight() {
          MinimumSchedule();
          times.push("18:00", "20:00");
          starts.push(64800, 72000);
          names.push("Navigation Night", "End of Day");
        }
        function noSchool() {
          times.length = 0;
          starts.length = 0;
          names.length = 0;
          clearSelectedStateButtons();
          clearAll();
          Grab("timer_type").innerHTML = "No School";
        }

        function clearAll() {
          let divIds = [
            "timer_type",
            "subtitle",
            "currentdt",
            "currentperiodsubtitle",
            "currentschedue",
            "currentlengthofperiod",
            "endofschedulesubtitle",
            "currentduration",
            "nextperiodsubtitle",
            "nextschedule",
            "nextduration",
          ];

          // Iterate over each div ID and clear the content
          divIds.forEach(function (id) {
            let div = document.getElementById(id);
            if (div) {
              div.innerHTML = "";
            }
          });
        }

        function NormalSchedule() {
          schedule = 0;
          handleButtonClick();

          // Clear the existing arrays
          times.length = 0;
          starts.length = 0;
          names.length = 0;

          if (isEven) {
            Grab("timer_type").innerHTML = "EVEN NORMAL BLOCK";
            times.push(
              "08:30",
              "10:02",
              "10:11",
              "10:17",
              "11:49",
              "11:55",
              "13:27",
              "13:58",
              "14:04",
              "15:36"
            );
            updateStarts();
            names.push(
              "Period 2",
              "Snack",
              "Passing Period",
              "Period 4",
              "Passing Period",
              "Period 6",
              "Lunch",
              "Passing Period",
              "Period 8",
              "End of School"
            );
          } else {
            Grab("timer_type").innerHTML = "ODD NORMAL BLOCK";
            times.push(
              "08:30",
              "10:02",
              "10:11",
              "10:17",
              "11:49",
              "11:55",
              "13:27",
              "13:58",
              "14:04",
              "15:36"
            );
            updateStarts();
            names.push(
              "Period 1",
              "Snack",
              "Passing Period",
              "Period 3",
              "Passing Period",
              "Period 5",
              "Lunch",
              "Passing Period",
              "Period 7",
              "End of School"
            );
          }

          clearSelectedStateButtons();

          var button = GrabQuery("#normal-schedule");
          button.classList.add("selected-state");
        }

        function clearSelectedStateButtons() {
          var buttons = document.querySelectorAll(".schedule-button");
          buttons.forEach(function (button) {
            button.classList.remove("selected-state");
          });
        }

        function LateSchedule() {
          schedule = 1;
          handleButtonClick();

          times.length = 0;
          starts.length = 0;
          names.length = 0;
          times.push(
            "10:00",
            "11:09",
            "11:18",
            "11:24",
            "12:35",
            "12:41",
            "13:50",
            "14:21",
            "14:27",
            "15:36"
          );
          updateStarts();
          if (isEven) {
            Grab("timer_type").innerHTML = "EVEN LATE BLOCK";
            names.push(
              "Period 2",
              "Snack",
              "Passing Period",
              "Period 4",
              "Passing Period",
              "Period 6",
              "Lunch",
              "Passing Period",
              "Period 8",
              "End of School"
            );
          } else {
            Grab("timer_type").innerHTML = "ODD LATE BLOCK";
            names.push(
              "Period 1",
              "Snack",
              "Passing Period",
              "Period 3",
              "Passing Period",
              "Period 5",
              "Lunch",
              "Passing Period",
              "Period 7",
              "End of School"
            );
          }

          clearSelectedStateButtons();

          var button = GrabQuery("#late-schedule");
          button.classList.add("selected-state");
        }

        function MinimumSchedule() {
          schedule = 2;
          handleButtonClick();

          times.length = 0;
          starts.length = 0;
          names.length = 0;
          times.push(
            "08:30",
            "09:34",
            "09:43",
            "09:49",
            "10:56",
            "11:02",
            "12:06",
            "12:12",
            "13:16"
          );
          updateStarts();
          if (isEven) {
            Grab("timer_type").innerHTML = "EVEN MINIMUM BLOCK";
            names.push(
              "Period 2",
              "Snack",
              "Passing Period",
              "Period 4",
              "Passing Period",
              "Period 6",
              "Passing Period",
              "Period 8",
              "End of School"
            );
          } else {
            Grab("timer_type").innerHTML = "ODD MINIMUM BLOCK";
            names.push(
              "Period 1",
              "Snack",
              "Passing Period",
              "Period 3",
              "Passing Period",
              "Period 5",
              "Passing Period",
              "Period 7",
              "End of School"
            );
          }

          clearSelectedStateButtons();

          var button = GrabQuery("#minimum-schedule");
          button.classList.add("selected-state");
        }

        function AnchorSchedule() {
          schedule = 4;
          Grab("timer_type").innerHTML = "ANCHOR DAY";

          // Clear the arrays
          times.length = 0;
          starts.length = 0;
          names.length = 0;

          // Push the values into the arrays
          times.push(
            "10:00",
            "10:31",
            "10:37",
            "11:14",
            "11:23",
            "11:29",
            "12:00",
            "12:06",
            "12:37",
            "13:08",
            "13:14",
            "13:45",
            "13:51",
            "14:22",
            "14:28",
            "14:59",
            "15:05",
            "15:36"
          );
          updateStarts();
          names.push(
            "Period 1",
            "Snack",
            "Period 2",
            "Snack",
            "Passing Period",
            "Period 3",
            "Passing Period",
            "Period 4",
            "Lunch",
            "Passing Period",
            "Period 5",
            "Passing Period",
            "Period 6",
            "Passing Period",
            "Period 7",
            "Passing Period",
            "Period 8",
            "End of School"
          );
        }

        function updateStarts() {
          starts = times.map((time) => {
            let [hours, minutes] = time.split(":").map(Number);
            return hours * 3600 + minutes * 60;
          });
        }

        function RallySchedule() {
          schedule = 3;
          times.length = 0;
          starts.length = 0;
          names.length = 0;
          times.push(
            "08:30",
            "09:50",
            "10:00",
            "10:06",
            "11:04",
            "12:13",
            "12:19",
            "13:39",
            "14:10",
            "14:16",
            "15:36"
          );
          updateStarts();
          if (isEven) {
            Grab("timer_type").innerHTML = "EVEN RALLY DAY";
            names.push(
              "Period 2",
              "Snack",
              "Passing Period",
              "Rally A (P4)",
              "Rally B (P4)",
              "Passing Period",
              "Period 6",
              "Lunch",
              "Passing Period",
              "Period 8",
              "End of School"
            );
          } else {
            Grab("timer_type").innerHTML = "ODD RALLY DAY";
            names.push(
              "Period 1",
              "Snack",
              "Passing Period",
              "Rally A (P3)",
              "Rally B (P3)",
              "Passing Period",
              "Period 5",
              "Lunch",
              "Passing Period",
              "Period 7",
              "End of School"
            );
          }
        }

        function ExtendedSnackSchedule() {
          schedule = 5;
          Grab("timer_type").innerHTML = "MINIMUM DAY";
          Grab("subtitle").innerHTML = "(Extended Snack)";

          // Clear the arrays
          times.length = 0;
          starts.length = 0;
          names.length = 0;

          // Push the values into the arrays
          times.push(
            "08:30",
            "08:58",
            "09:04",
            "09:32",
            "09:38",
            "10:06",
            "10:12",
            "10:40",
            "11:00",
            "11:06",
            "11:34",
            "11:40",
            "12:08",
            "12:14",
            "12:42",
            "12:48",
            "13:16"
          );
          updateStarts();
          names.push(
            "Period 1",
            "Passing Period",
            "Period 2",
            "Passing Period",
            "Period 3",
            "Passing Period",
            "Period 4",
            "Extended Snack",
            "Passing Period",
            "Period 5",
            "Passing Period",
            "Period 6",
            "Passing Period",
            "Period 7",
            "Passing Period",
            "Period 8",
            "End of School"
          );
        }

        // handles switching between even and odd
        function ToggleScheduleOddEven() {
          isEven = !isEven;
          switch (schedule) {
            case 0:
              NormalSchedule();
              break;
            case 1:
              LateSchedule();
              break;
            case 2:
              MinimumSchedule();
              break;
            case 3:
              RallySchedule();
              break;
            default:
              NormalSchedule();
          }
          var button = GrabQuery("#odd-even-toggle");
          if (isEven) {
            button.classList.remove("normal-state");
            button.classList.add("toggled-state");
          } else {
            button.classList.remove("toggled-state");
            button.classList.add("normal-state");
          }
        }

        function HandleSpecialScheduleChange() {
          updateSpecialScheduleDropdown();
          updateOddEvenToggleButton();
          clearSelectedStateButtons();
          handleSpecialScheduleSelection();
          updateClock();
        }

        function updateSpecialScheduleDropdown() {
          var dropdown = Grab("special-schedule");
          var selectedIndex = dropdown.selectedIndex;

          if (selectedIndex !== 0) {
            dropdown.classList.add("special-schedule-select");
            dropdown.style.backgroundColor = "grey";
          } else {
            dropdown.classList.remove("special-schedule-select");
            dropdown.style.backgroundColor = ""; // Reset to default color
          }
        }

        function updateOddEvenToggleButton() {
          var dropdown = Grab("special-schedule");
          var selectedIndex = dropdown.selectedIndex;
          var oddEvenButton = Grab("odd-even-toggle");

          if (selectedIndex === 0 || selectedIndex === 2) {
            oddEvenButton.style.display = "inline";
          } else {
            oddEvenButton.style.display = "none";
          }
        }

        function clearSelectedStateButtons() {
          var buttons = document.querySelectorAll(".selected-state");
          buttons.forEach(function (button) {
            button.classList.remove("selected-state");
          });
        }
        // Dropdown
        function handleSpecialScheduleSelection() {
          var selectedOption = Grab("special-schedule").value;
          switch (selectedOption) {
            case "Nothing":
              NormalSchedule();
              ClearSubtitle();
              break;
            case "anchorSchedule":
              AnchorSchedule();
              ClearSubtitle();
              break;
            case "rallySchedule":
              RallySchedule();
              ClearSubtitle();
              break;
            case "ExtendedSnackSchedule":
              ExtendedSnackSchedule();
              break;
            default:
              break;
          }
        }

        function ClearSubtitle() {
          Grab("subtitle").innerHTML = "";
        }
      </script>
    </div>
  </body>
</html>
